# DungeonMaker: 手続き型迷路生成とゲームプレイ

*注: この README.md の一部は AI アシスタント (Claude) によって生成されています。*

## 目次

- [DungeonMaker: 手続き型迷路生成とゲームプレイ](#dungeonmaker-手続き型迷路生成とゲームプレイ)
  - [目次](#目次)
  - [概要](#概要)
  - [特徴](#特徴)
  - [インストール](#インストール)
  - [セットアップ](#セットアップ)
    - [音声ファイル](#音声ファイル)
    - [フォント設定](#フォント設定)
  - [ゲームルールと操作方法](#ゲームルールと操作方法)
    - [目的](#目的)
    - [プレイヤーの状態](#プレイヤーの状態)
    - [基本操作](#基本操作)
    - [アイテム使用](#アイテム使用)
    - [アイテム効果](#アイテム効果)
    - [ゲームの進行](#ゲームの進行)
    - [特殊能力](#特殊能力)
    - [戦略のヒント](#戦略のヒント)
  - [使用方法](#使用方法)
  - [アルゴリズム](#アルゴリズム)
    - [1. 迷路生成](#1-迷路生成)
    - [2. 難易度計算](#2-難易度計算)
    - [3. 光の伝播](#3-光の伝播)
    - [4. 経路探索](#4-経路探索)
    - [5. 敵AI](#5-敵ai)
  - [貢献](#貢献)
  - [ライセンス](#ライセンス)

## 概要

DungeonMakerは、手続き型迷路生成と魅力的なゲームプレイ体験を組み合わせた高度なPythonプロジェクトです。複雑な多領域迷路を作成するための先進的なアルゴリズムを使用し、リソース管理と敵の回避が必要なチャレンジングなゲームを実装しています。

## 特徴

- セルオートマトンを使用した手続き型迷路生成
- 多領域迷路構造
- 熱拡散を用いた動的難易度計算
- 知的なスタートとゴールポイントの選択
- Pygameベースのゲームプレイ：
  - 動的照明とフォグオブウォー
  - 複数の行動パターンを持つ敵AI
  - パワーアップと特殊能力
  - リソース管理（MPと視界）

## インストール

1. リポジトリをクローンします：

   ```
   git clone https://github.com/Shinh0707/PythonDungeonMaker1.git
   ```

2. 必要な依存関係をインストールします：

   ```
   pip install numpy scipy matplotlib pygame opencv-python tqdm
   ```

## セットアップ

### 音声ファイル

ゲームを正しく動作させるためには、以下の音声ファイルが必要です。これらのファイルを `sounds/` ディレクトリに配置してください。このディレクトリは `MazeGame.SOUND_DIR` で定義されています。

- `hint.mp3`: ヒントの矢印を表示する時の効果音
- `goal.mp3`: ゴールしたときの効果音
- `teleport.mp3`: テレポートしたときの効果音
- `game_over.mp3`: ゲームオーバーのときの効果音
- `hit_enemy.mp3`: 敵に当たったときの効果音
- `light.mp3`: 光を強めるときの効果音
- `light_end.mp3`: 光を強めるのをやめたときの効果音
- `monster_move.mp3`: モンスターが動いているときの効果音
- `pathfinder.mp3`: ゴールまでの部分経路を出現させるときの効果音
- `extra_light.mp3`: 一時的に明るくなるときの効果音
- `vision_monster.mp3`: モンスターを表示するときの効果音

### フォント設定

デフォルトでは、"C:/Windows/Fonts"がFONT_DIRとして、"HGRGM.TTF"がFONT_NAMEとして設定されており、HGゴシックがデフォルトフォントとして使用されています。これらの設定は以下のように変更できます：

- `MazeGame.FONT_DIR`: フォントファイルが格納されているディレクトリを指定
- `MazeGame.FONT_NAME`: 使用するフォントファイル名を指定

必要に応じて、これらの値を書き換えることで、使用するフォントを変更できます。

## ゲームルールと操作方法

### 目的

プレイヤーの目的は、迷路内を探索し、ゴール地点に到達することです。その過程で、敵を回避し、リソース（MP[魔力]と視界）を管理しながら進む必要があります。

### プレイヤーの状態

1. MP (魔力)：最大20ポイント。様々な行動に消費され、時間経過で回復します。
2. 視界：最大値は設定により変動。敵との衝突で減少し、時間経過で回復します。

### 基本操作

- 移動：矢印キー（↑↓←→）を使用
- ヒント表示：SPACEキー（MPを10消費）
- テレポート：Qキーを押した後、方向キーで方向を選択
- 視界拡大：Eキーを長押し（MPを継続的に消費）

### アイテム使用

- 1キー：1番目のアイテムを使用
- 2キー：2番目のアイテムを使用

### アイテム効果

1. モンスタービジョン：一定時間、全ての敵の位置が見えるようになります。
2. エクストラライト：一定時間、視界が大幅に拡大します。
3. パスファインダー：一定時間、ゴールまでの経路の一部が表示されます。

### ゲームの進行

1. プレイヤーは迷路内を探索し、ゴールを目指します。
2. 敵（モンスター）が迷路内を移動しており、接触するとダメージを受けます。
3. ダメージを受けると視界が狭くなり、一時的に無敵状態になります。
4. 視界が完全になくなるとゲームオーバーです。
5. MPを消費してヒントを表示したり、テレポートしたり、視界を一時的に拡大したりできます。
6. 時間経過とともに新しい敵が出現するため、素早く行動する必要があります。

### 特殊能力

1. テレポート：
   - Qキーを押した後、方向キーで移動方向を選択
   - 現在の視界の範囲内で壁にぶつかるまで瞬間移動
   - MP5を消費し、視界も少し減少
   - 最低10MPと1.5の視界が必要

2. 視界拡大：
   - Eキーを長押しすることで視界を一時的に拡大
   - 継続的にMPを消費（1秒あたり5MP）
   - 最低5MPが必要

3. ヒント表示：
   - SPACEキーを押すとゴールの方向を示す矢印が3秒間表示
   - 10MPを消費

### 戦略のヒント

- MPと視界のバランスを取りながら進むことが重要です。
- テレポートは敵から逃げるのに有効ですが、MPと視界を消費するため慎重に使用しましょう。
- アイテムは状況に応じて適切に使用することで、ゲームを有利に進められます。
- 敵の動きをよく観察し、パターンを理解することで効率的に回避できます。

このゲームは戦略的思考と素早い判断が求められる挑戦的な迷路ゲームです。様々な能力とアイテムを駆使して、ゴールを目指してください！

## 使用方法

メインスクリプトを実行して迷路を生成し、ゲームを開始します：

```python
python DungeonMaker.py
```

## アルゴリズム

### 1. 迷路生成

迷路はセルオートマトンアプローチを使用して生成され、ランダムな初期状態から複雑で有機的な構造を作り出すために反復的に洗練されます。

### 2. 難易度計算

迷路の難易度は熱拡散アルゴリズムを使用して計算されます。このプロセスは以下の偏微分方程式で表すことができます：

∂u/∂t = α∇²u

ここで：

- u は難易度値
- t は時間
- α は拡散係数
- ∇² はラプラス演算子

この方程式は離散化され、有限差分法を用いて数値的に解かれます。

### 3. 光の伝播

ゲーム内の光の伝播はカスタム拡散アルゴリズムを使用してシミュレートされ、以下のように表現できます：

L(t+1) = L(t) + α(K * L(t))

ここで：

- L は光強度行列
- t はタイムステップ
- α は拡散率
- K は光の広がりを表す畳み込みカーネル
- * は畳み込み演算を示します

### 4. 経路探索

ゲームは経路探索に幅優先探索アルゴリズムを使用しています。以下のように記述できます：

1. スタートノードでキューQを初期化
2. Qが空でない間：
   a. Qからノードvをデキュー
   b. vがゴールなら、経路を返す
   c. vの各隣接ノードwについて：
      wが未訪問なら：
         wを訪問済みとマーク
         wをQにエンキュー
3. ループが終了した場合、経路は存在しない

### 5. 敵AI

敵はランダムウォーク、壁沿い探索アルゴリズム、標的追跡など、さまざまな移動戦略を使用します。これらは状態機械と確率ベースの意思決定を用いて実装されています。

## 貢献

DungeonMakerへの貢献を歓迎します！プルリクエストを気軽に提出してください。

## ライセンス

このプロジェクトはMITライセンスの下でライセンスされています - 詳細は[LICENSE](LICENSE)ファイルを参照してください。
