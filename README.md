# DungeonMaker: 手続き型迷路生成とゲームプレイ

## 概要

DungeonMakerは、手続き型迷路生成と魅力的なゲームプレイ体験を組み合わせた高度なPythonプロジェクトです。複雑な多領域迷路を作成するための先進的なアルゴリズムを使用し、リソース管理と敵の回避が必要なチャレンジングなゲームを実装しています。

## 特徴

- セルオートマトンを使用した手続き型迷路生成
- 多領域迷路構造
- 熱拡散を用いた動的難易度計算
- 知的なスタートとゴールポイントの選択
- Pygameベースのゲームプレイ：
  - 動的照明とフォグオブウォー
  - 複数の行動パターンを持つ敵AI
  - パワーアップと特殊能力
  - リソース管理（MPと視界）

## インストール

1. リポジトリをクローンします：
   ```
   git clone https://github.com/Shinh0707/PythonDungeonMaker1.git
   ```
2. 必要な依存関係をインストールします：
   ```
   pip install numpy scipy matplotlib pygame opencv-python tqdm
   ```

## セットアップ

### 音声ファイル

ゲームを正しく動作させるためには、以下の音声ファイルが必要です。これらのファイルを `sounds/` ディレクトリに配置してください。このディレクトリは `MazeGame.SOUND_DIR` で定義されています。

- `hint.mp3`: ヒントの矢印を表示する時の効果音
- `goal.mp3`: ゴールしたときの効果音
- `teleport.mp3`: テレポートしたときの効果音
- `game_over.mp3`: ゲームオーバーのときの効果音
- `hit_enemy.mp3`: 敵に当たったときの効果音
- `light.mp3`: 光を強めるときの効果音
- `light_end.mp3`: 光を強めるのをやめたときの効果音
- `monster_move.mp3`: モンスターが動いているときの効果音
- `pathfinder.mp3`: ゴールまでの部分経路を出現させるときの効果音
- `extra_light.mp3`: 一時的に明るくなるときの効果音
- `vision_monster.mp3`: モンスターを表示するときの効果音

### フォント設定

デフォルトでは、"C:/Windows/Fonts"がFONT_DIRとして、"HGRGM.TTF"がFONT_NAMEとして設定されており、HGゴシックがデフォルトフォントとして使用されています。これらの設定は以下のように変更できます：

- `MazeGame.FONT_DIR`: フォントファイルが格納されているディレクトリを指定
- `MazeGame.FONT_NAME`: 使用するフォントファイル名を指定

必要に応じて、これらの値を書き換えることで、使用するフォントを変更できます。

## 使用方法

メインスクリプトを実行して迷路を生成し、ゲームを開始します：

```python
python DungeonMaker.py
```

## アルゴリズム

### 1. 迷路生成

迷路はセルオートマトンアプローチを使用して生成され、ランダムな初期状態から複雑で有機的な構造を作り出すために反復的に洗練されます。

### 2. 難易度計算

迷路の難易度は熱拡散アルゴリズムを使用して計算されます。このプロセスは以下の偏微分方程式で表すことができます：

∂u/∂t = α∇²u

ここで：
- u は難易度値
- t は時間
- α は拡散係数
- ∇² はラプラス演算子

この方程式は離散化され、有限差分法を用いて数値的に解かれます。

### 3. 光の伝播

ゲーム内の光の伝播はカスタム拡散アルゴリズムを使用してシミュレートされ、以下のように表現できます：

L(t+1) = L(t) + α(K * L(t))

ここで：
- L は光強度行列
- t はタイムステップ
- α は拡散率
- K は光の広がりを表す畳み込みカーネル
- * は畳み込み演算を示します

### 4. 経路探索

ゲームは経路探索に幅優先探索アルゴリズムを使用しています。以下のように記述できます：

1. スタートノードでキューQを初期化
2. Qが空でない間：
   a. Qからノードvをデキュー
   b. vがゴールなら、経路を返す
   c. vの各隣接ノードwについて：
      wが未訪問なら：
         wを訪問済みとマーク
         wをQにエンキュー
3. ループが終了した場合、経路は存在しない

### 5. 敵AI

敵はランダムウォーク、壁沿い探索アルゴリズム、標的追跡など、さまざまな移動戦略を使用します。これらは状態機械と確率ベースの意思決定を用いて実装されています。

## 貢献

DungeonMakerへの貢献を歓迎します！プルリクエストを気軽に提出してください。

## ライセンス

このプロジェクトはMITライセンスの下でライセンスされています - 詳細は[LICENSE](LICENSE)ファイルを参照してください。
